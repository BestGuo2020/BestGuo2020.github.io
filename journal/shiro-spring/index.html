<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="BestGuo2020"><meta name="copyright" content="BestGuo2020"><meta name="generator" content="Hexo 6.2.0"><meta name="theme" content="hexo-theme-yun"><title>Shiro ä¸ SpringBoot æ•´åˆ | BestGuo çš„å°çª</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.3.3/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/@unocss/runtime/mini.global.js"></script><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"www.bestguo.top","root":"/","title":["Best","Guo","çš„","å°","çª"],"version":"1.10.0","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"fireworks":{"colors":null},"waline":{"config":{"enable":true,"serverURL":"https://comment.bestguo.top","comment":true,"requiredFields":["nick","mail"],"placeholder":"æœ‰ä»€ä¹ˆæƒ³è¦å¯¹ BestGuo è¯´çš„å‘¢ï¼Œè¾“å…¥æ­£ç¡®æœ‰æ•ˆçš„é‚®ç®±æœ‰æœºä¼šæ”¶åˆ°å›å¤å“ŸğŸ˜ŠğŸ˜Š","avatarCDN":"https://seccdn.libravatar.org/avatar/","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo/","https://unpkg.com/@waline/emojis@1.0.1/bilibili/","https://unpkg.com/@waline/emojis@1.0.1/qq/","https://unpkg.com/@waline/emojis@1.0.1/tieba/"],"avatar":"monsterid","el":"#waline","lang":"zh-CN"},"cdn":"https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.js","dark":"html.dark"},"vendors":{"darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-907LWSSHLS"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-907LWSSHLS');
}</script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="å‰ç¯‡æ—¥å¿—äº†è§£åˆ° Shiro æ˜¯ä»€ä¹ˆï¼ŒShiro å¯ä»¥åšä»€ä¹ˆï¼Œä»¥åŠ Shiro ç»“åˆ ini æ–‡ä»¶æ¥åšä¸€ä¸ªç®€å•çš„æƒé™ç®¡ç†çš„ç¤ºä¾‹ã€‚ æ¥ä¸‹æ¥ï¼Œå°±æ˜¯å°† Shiro ä¸ SpringBoot è¿›è¡Œæ•´åˆï¼Œç„¶åç»“åˆæ•°æ®åº“å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ã€‚ æ•´åˆçš„åŸºæœ¬æ€è·¯åœ¨æœªæ•´åˆ SpringBoot ä¹‹å‰ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯åœ¨æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥è¦è¯»å– ini é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬çš„æ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Shiro ä¸ SpringBoot æ•´åˆ">
<meta property="og:url" content="https://www.bestguo.top/journal/shiro-spring/index.html">
<meta property="og:site_name" content="BestGuo çš„å°çª">
<meta property="og:description" content="å‰ç¯‡æ—¥å¿—äº†è§£åˆ° Shiro æ˜¯ä»€ä¹ˆï¼ŒShiro å¯ä»¥åšä»€ä¹ˆï¼Œä»¥åŠ Shiro ç»“åˆ ini æ–‡ä»¶æ¥åšä¸€ä¸ªç®€å•çš„æƒé™ç®¡ç†çš„ç¤ºä¾‹ã€‚ æ¥ä¸‹æ¥ï¼Œå°±æ˜¯å°† Shiro ä¸ SpringBoot è¿›è¡Œæ•´åˆï¼Œç„¶åç»“åˆæ•°æ®åº“å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ã€‚ æ•´åˆçš„åŸºæœ¬æ€è·¯åœ¨æœªæ•´åˆ SpringBoot ä¹‹å‰ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯åœ¨æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥è¦è¯»å– ini é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬çš„æ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.bestguo.top/journal/shiro-spring/image-20220329102659182.png">
<meta property="og:image" content="https://www.bestguo.top/journal/shiro-spring/image-20220329114737704.png">
<meta property="og:image" content="https://www.bestguo.top/journal/shiro-spring/image-20220329143610917.png">
<meta property="og:image" content="https://www.bestguo.top/journal/shiro-spring/image-20220329114737704.png">
<meta property="article:published_time" content="2022-03-28T09:11:23.000Z">
<meta property="article:modified_time" content="2022-05-25T10:47:49.031Z">
<meta property="article:author" content="BestGuo2020">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="Shiro">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.bestguo.top/journal/shiro-spring/image-20220329102659182.png"><script type="module">import { getScript } from '/js/utils.js'
getScript("https://fastly.jsdelivr.net/npm/mermaid/dist/mermaid.min.js", () => {
  const mermaidOptions = {"startOnload":true}
  mermaid.initialize(mermaidOptions);
}, window.mermaid);
</script><style>.mermaid{background: transparent;}</style><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="BestGuo2020"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="BestGuo2020"><span class="site-author-status" title="æ¯•ä¸šå•¦">ğŸ‘¨â€ğŸ“</span></a><div class="site-author-name"><a href="/about/">BestGuo2020</a></div><a class="site-name" href="/about/site.html">BestGuo çš„å°çª</a><sub class="site-subtitle">å–„è‰¯ã€å‹‡æ•¢ã€å¯çˆ±</sub><div class="site-description">ä¸€ä¸ªäººçš„ä¸–ç•Œæ˜¯å¦‚æ­¤çš„å®‰é™</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="é¦–é¡µ"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">72</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">21</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">47</span></a></div><a class="site-state-item hty-icon-button" href="/albums/" title="ç›¸å†Œé›†"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:gallery-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1540113012&amp;site=qq&amp;menu=yes" title="QQï¼šxiaohehe2021" target="_blank" style="color:#12B7F5"><span class="icon iconify" data-icon="ri:qq-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/bestguo2020" title="GitHubï¼šBestGuo2020" target="_blank" style="color:#8251e6"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/184681623" title="å“”å“©å“”å“©: æˆ‘å«äººå‘˜å¤–å©†" target="_blank" style="color:#FF8EB3"><span class="icon iconify" data-icon="ri:bilibili-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:bestguo2020@foxmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF"><span class="toc-number">1.</span> <span class="toc-text">æ•´åˆçš„åŸºæœ¬æ€è·¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">2.</span> <span class="toc-text">å¯¼å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">æ–°å»ºé¡µé¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#login-jsp"><span class="toc-number">4.1.</span> <span class="toc-text">login.jsp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#register-jsp"><span class="toc-number">4.2.</span> <span class="toc-text">register.jsp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index-jsp"><span class="toc-number">4.3.</span> <span class="toc-text">index.jsp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">5.</span> <span class="toc-text">èµ„æºè®¿é—®æ§åˆ¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.</span> <span class="toc-text">æ•°æ®åº“è®¾è®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.</span> <span class="toc-text">æ³¨å†ŒåŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.</span> <span class="toc-text">ç™»å½•åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.</span> <span class="toc-text">é€€å‡ºç™»å½•åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.</span> <span class="toc-text">æˆæƒåŠŸèƒ½å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%88%A4%E6%96%AD%E6%96%B9%E5%BC%8F"><span class="toc-number">10.1.</span> <span class="toc-text">æƒé™åˆ¤æ–­æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Shiro-%E6%A0%87%E7%AD%BE%E5%AF%B9%E5%88%A4%E6%96%AD%E6%96%B9%E5%BC%8F"><span class="toc-number">10.1.1.</span> <span class="toc-text">Shiro æ ‡ç­¾å¯¹åˆ¤æ–­æ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%88%A4%E6%96%AD%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">10.1.2.</span> <span class="toc-text">ç¨‹åºåˆ¤æ–­çš„æ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%88%A4%E6%96%AD%E6%96%B9%E5%BC%8F"><span class="toc-number">10.1.3.</span> <span class="toc-text">æ³¨è§£åˆ¤æ–­æ–¹å¼</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">11.</span> <span class="toc-text">é™„å½•</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://www.bestguo.top/journal/shiro-spring/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="BestGuo2020"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="BestGuo çš„å°çª"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Shiro ä¸ SpringBoot æ•´åˆ</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-03-28 17:11:23" itemprop="dateCreated datePublished" datetime="2022-03-28T17:11:23+08:00">2022-03-28</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-05-25 18:47:49" itemprop="dateModified" datetime="2022-05-25T18:47:49+08:00">2022-05-25</time></div><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="é˜…è¯»æ¬¡æ•°"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><span class="post-meta-divider">-</span><a href="#comment"><span class="post-meta-item-icon" title="è¯„è®ºæ•°"><span class="icon iconify" data-icon="ri:chat-3-line"></span> <span class="waline-comment-count" id="/journal/shiro-spring/"></span></span></a><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">åç«¯å¼€å‘</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/%E6%9D%83%E9%99%90%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E5%8E%86%E7%A8%8B/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">æƒé™æ¡†æ¶å­¦ä¹ å†ç¨‹</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/Java/" style="--text-color:#ff9900"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">Java</span></a><a class="tag-item" href="/tags/SpringBoot/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">SpringBoot</span></a><a class="tag-item" href="/tags/Shiro/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">Shiro</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><p>å‰ç¯‡æ—¥å¿—äº†è§£åˆ° Shiro æ˜¯ä»€ä¹ˆï¼ŒShiro å¯ä»¥åšä»€ä¹ˆï¼Œä»¥åŠ Shiro ç»“åˆ ini æ–‡ä»¶æ¥åšä¸€ä¸ªç®€å•çš„æƒé™ç®¡ç†çš„ç¤ºä¾‹ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°±æ˜¯å°† Shiro ä¸ SpringBoot è¿›è¡Œæ•´åˆï¼Œç„¶åç»“åˆæ•°æ®åº“å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ã€‚</p>
<h2 id="æ•´åˆçš„åŸºæœ¬æ€è·¯"><a href="#æ•´åˆçš„åŸºæœ¬æ€è·¯" class="headerlink" title="æ•´åˆçš„åŸºæœ¬æ€è·¯"></a>æ•´åˆçš„åŸºæœ¬æ€è·¯</h2><p>åœ¨æœªæ•´åˆ SpringBoot ä¹‹å‰ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯åœ¨æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥è¦è¯»å– ini é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬çš„æ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<span id="more"></span>

<pre class="mermaid">graph

A(åˆ›å»º IniSecurityManagerFactory å¯¹è±¡) --> B(è·å– SecurityManager å®ä¾‹å¯¹è±¡)
B --> C(å°† SecurityManager å¯¹è±¡ä¿å­˜åˆ° SecurityUtils ä¸­)
C --> D(è·å– Subject å¯¹è±¡)
D --> E(è°ƒç”¨ç›¸å…³æ–¹æ³•: ç™»å½•, è§’è‰²åˆ¤æ–­ç­‰)</pre>



<p>åœ¨ Spring Web ä¸­ï¼Œæ•´åˆçš„æ­¥éª¤å’Œä¸Šè¿°åŸºæœ¬ä¸€è‡´ã€‚</p>
<p>ä½†æ˜¯ï¼Œç°åœ¨å˜äº†ï¼Œç”±äºç°åœ¨æ˜¯å¤„äº Spring Web çš„ç¯å¢ƒä¸­ï¼Œè¦æ§åˆ¶è®¿é—®ç½‘ç«™èµ„æºçš„æƒé™ï¼Œå“ªäº›èµ„æºå¯ä»¥åŒ¿åè®¿é—®ï¼Œå“ªäº›èµ„æºéœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ç­‰ç­‰ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ Shiro çš„ Filterï¼Œè€Œä¸æ˜¯ SecurityManagerFactory å¯¹è±¡ã€‚</p>
<p>é¦–å…ˆ Shiro ä¸­æœ‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå« ShiroFilterFactoryBean ï¼Œåˆ©ç”¨å®ƒå¯ä»¥æ§åˆ¶èµ„æºè®¿é—®ï¼ŒåŒæ—¶å¯ä»¥è®¾ç½®è¿‡æ»¤å™¨çš„ç±»å‹æ¥è¿‡æ»¤æŸäº›è¯·æ±‚ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ SecurityManager ï¼Œåœ¨ Spring Web çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ— æ³•åœ¨è¿‡æ»¤å™¨ä¸­æ‰¾åˆ° getInstance æ–¹æ³•ï¼Œè€Œæ˜¯éœ€è¦åˆ›å»º DefaultWebSecurityManager å¯¹è±¡ï¼Œå°†è¯¥å¯¹è±¡æ”¾åˆ° ShiroFilterFactoryBean ä¸­ã€‚</p>
<p>æœ€åå°±æ˜¯ Realm äº†ï¼ŒRealm åšçš„äº‹æƒ…ä¸»è¦æ˜¯æˆæƒå’Œè®¤è¯äº†ï¼Œå¯è‡ªå®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ Realm ç»§æ‰¿è‡ª AuthorizingRealmã€‚å°†è‡ªå®šä¹‰çš„ Realm æ·»åŠ åˆ° DefaultWebSecurityManager å¯¹è±¡ä¸­å³å¯ï¼Œ</p>
<p>åé¢çš„æ“ä½œå°±åŸºæœ¬ä¸€è‡´äº†ï¼Œæ¯”å¦‚è°ƒç”¨ SecurityUtils æ–¹æ³•ç­‰ç­‰ã€‚</p>
<p>åœ¨äº†è§£é web ç¯å¢ƒä¸‹çš„è°ƒç”¨æ­¥éª¤ä»¥åŠä¸Šè¿°çš„æ•´åˆæ­¥éª¤ä¹‹åï¼Œå¯çŸ¥æ¯ä¸ªç»„ä»¶çš„ä¾èµ–å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<pre class="mermaid">graph LR
è‡ªå®šä¹‰Realm --> DefaultWebSecurityFactoryBean-->ShiroFactoryBean</pre>

<p>æ¥ä¸‹æ¥ï¼Œå°±é€šè¿‡ SpringBoot æ¥æ•´åˆ Shiroã€‚</p>
<h2 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h2><p>å…ˆé€šè¿‡ Spring Initializer åˆå§‹åŒ–é¡¹ç›®æ¨¡æ¿ï¼Œç„¶åå¯¼å…¥ Shiro çš„ spring-boot-starterã€‚</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>shiro-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>

<p>åé¢éœ€è¦ç”¨åˆ° MySQLï¼Œä½¿ç”¨ MyBatis-Plus æ¥æ“ä½œæ•°æ®åº“ï¼ŒJDBCï¼Œè¿æ¥æ±  Druidï¼Œä»¥åŠæ˜¯ç”¨ jsp æ–‡ä»¶æ¥åšé¡µé¢æ¸²æŸ“ï¼Œå¯¼å…¥ jsp ç›¸å…³çš„ä¾èµ–ã€‚</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>shiro-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>8.0.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>

<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>åˆ›å»ºä¸€ä¸ª ShiroConfig ç±»ï¼Œç”¨äºé…ç½® Shiroï¼ŒæŒ‰ç…§ä¹‹å‰çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥è¿™æ ·é…ç½®ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 1ã€åˆ›å»º ShiroFilter</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">shiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ShiroFilterFactoryBean</span> factoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é…ç½®å®‰å…¨ç®¡ç†å™¨</span>
        factoryBean<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>defaultWebSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> factoryBean<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 2ã€åˆ›å»º SecurityManager å¯¹è±¡</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">defaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">Realm</span> realm<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">DefaultWebSecurityManager</span> securityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span>realm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        securityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>realm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> securityManager<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 3ã€åˆ›å»º Realmã€‚</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Realm</span> <span class="token function">realm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CustomerRealm</span> realm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomerRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> realm<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>è¿™äº›é…ç½®å®Œæˆä¹‹åï¼Œè¿˜éœ€è¦åœ¨ application.yml æ–‡ä»¶ä¸­é…ç½®å¥½æ•°æ®åº“ã€‚</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/yourdb<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> yourpassword

<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> top.bestguo.springboot_shiro.entity
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/mapper/<span class="token important">**/*.xml</span></code></pre>

<p>åœ¨ application.properties çš„é…ç½®ä¸­ï¼Œé…ç½®å¥½ jsp çš„å‰åç¼€ï¼Œä»¥åŠ web æœåŠ¡çš„ç«¯å£ç­‰ç­‰ã€‚</p>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># åº”ç”¨åç§°</span>
<span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">springboot_shiro</span>
<span class="token comment"># åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£</span>
<span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8080</span>
<span class="token attr-name">server.servlet.context-path</span><span class="token punctuation">=</span><span class="token attr-value">/shiro</span>

<span class="token attr-name">spring.mvc.view.prefix</span><span class="token punctuation">=</span><span class="token attr-value">/</span>
<span class="token attr-name">spring.mvc.view.suffix</span><span class="token punctuation">=</span><span class="token attr-value">.jsp</span>

<span class="token attr-name">logging.level.top.bestguo.springboot_shiro.mapper</span><span class="token punctuation">=</span><span class="token attr-value">debug</span></code></pre>

<h2 id="æ–°å»ºé¡µé¢"><a href="#æ–°å»ºé¡µé¢" class="headerlink" title="æ–°å»ºé¡µé¢"></a>æ–°å»ºé¡µé¢</h2><p>åˆ›å»ºä¸‰ä¸ªé¡µé¢ï¼Œåˆ†åˆ«æ˜¯ç™»å½•é¡µã€æ³¨å†Œé¡µå’Œç³»ç»Ÿä¸»é¡µã€‚è¿™äº›é¡µé¢åˆ†åˆ«åˆ›å»ºåœ¨ webapp æ–‡ä»¶å¤¹ä¸‹ï¼Œæ²¡æœ‰å¯ä»¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—® jsp æ–‡ä»¶ã€‚</p>
<p><img src="/journal/shiro-spring/image-20220329102659182.png" alt="image-20220329102659182" loading="lazy"></p>
<p>é¡µé¢éƒ½å¾ˆç®€å•ï¼Œè¿™ä¸‰ä¸ªé¡µé¢çš„çš„ä»£ç å¦‚ä¸‹ã€‚</p>
<h3 id="login-jsp"><a href="#login-jsp" class="headerlink" title="login.jsp"></a>login.jsp</h3><pre class="language-markup" data-language="markup"><code class="language-markup">&lt;%@page contentType="text/html; UTF-8" pageEncoding="UTF-8" isELIgnored="false" %>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ç™»å½•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pageContext.request.contextPath&#125;/user/login<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    ç”¨æˆ·åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    å¯†ç ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç™»å½•<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<h3 id="register-jsp"><a href="#register-jsp" class="headerlink" title="register.jsp"></a>register.jsp</h3><pre class="language-markup" data-language="markup"><code class="language-markup">&lt;%@page contentType="text/html; UTF-8" pageEncoding="UTF-8" isELIgnored="false" %>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>æ³¨å†Œ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pageContext.request.contextPath&#125;/user/register<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    ç”¨æˆ·åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    å¯†ç ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ³¨å†Œ<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<h3 id="index-jsp"><a href="#index-jsp" class="headerlink" title="index.jsp"></a>index.jsp</h3><pre class="language-markup" data-language="markup"><code class="language-markup">&lt;%@page contentType="text/html; UTF-8" pageEncoding="UTF-8" isELIgnored="false" %>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ç³»ç»Ÿä¸»é¡µV1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pageContext.request.contextPath&#125;/user/logout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ç™»å‡º<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ç”¨æˆ·ç®¡ç†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ·»åŠ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä¿®æ”¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>åˆ é™¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ›´æ–°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å•†å“ç®¡ç†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ç‰©æµç®¡ç†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>è®¢å•ç®¡ç†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<h2 id="èµ„æºè®¿é—®æ§åˆ¶"><a href="#èµ„æºè®¿é—®æ§åˆ¶" class="headerlink" title="èµ„æºè®¿é—®æ§åˆ¶"></a>èµ„æºè®¿é—®æ§åˆ¶</h2><p>é¡µé¢åˆ›å»ºå®Œæˆä¹‹åï¼Œæµ‹è¯•è¿™äº›é¡µé¢å‡èƒ½å¤Ÿæ­£å¸¸çš„è®¿é—®ã€‚ç”±äºä¸»é¡µæ˜¯ä¸èƒ½å¤Ÿç›´æ¥è®¿é—®çš„åˆ°çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨ Filter æ¥å…è®¸å“ªäº›é¡µé¢å¯ä»¥åŒ¿åè®¿é—®ï¼Œå“ªäº›é¡µé¢éœ€è¦éªŒè¯å’Œæˆæƒæ‰èƒ½è®¿é—®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ ShiroConfig ç±»ä¸­è®¾ç½®ã€‚</p>
<p>ShiroFilterFactoryBean ä¸­æœ‰ä¸€ä¸ª setFilterChainDefinitionMap æ–¹æ³•ï¼Œç”¨äºè®¾ç½®æ‹¦æˆªçš„èµ„æºï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ª map é›†åˆï¼Œkey ä¸ºè®¿é—®çš„è·¯å¾„ï¼Œvalue ä¸ºä½¿ç”¨çš„<a href="https://www.bestguo.top/journal/shiro-study/#Shiro-%E5%86%85%E7%BD%AE%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8">è¿‡æ»¤å™¨åç§°</a>ã€‚</p>
<p>åˆ©ç”¨é€šé…ç¬¦å¯ä»¥æ‹¦æˆªå­è·¯å¾„ä¸‹çš„èµ„æºï¼Œ <code>/**</code> å°±æ˜¯æ‹¦æˆªå…¨éƒ¨çš„ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">shiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ShiroFilterFactoryBean</span> factoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// é…ç½®å®‰å…¨ç®¡ç†å™¨</span>
    factoryBean<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>defaultWebSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// é…ç½®ç³»ç»Ÿå—é™èµ„æºå’Œå…¬å…±èµ„æº</span>
    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// authc è¯·æ±‚è¿™ä¸ªèµ„æºéœ€è¦è®¤è¯å’Œæˆæƒï¼Œanonå°±æ˜¯è¯¥èµ„æºæ— éœ€è®¤è¯</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/user/login"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/register.jsp"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/user/register"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">,</span> <span class="token string">"authc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    factoryBean<span class="token punctuation">.</span><span class="token function">setFilterChainDefinitionMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> factoryBean<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>å½“æˆ‘è®¿é—®è‡³ index.jsp é¡µé¢æ—¶ï¼Œå¦‚æœæœªè¿›è¡Œè®¤è¯ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è·³è½¬è‡³ login.jsp é¡µé¢ã€‚å› ä¸ºåœ¨ Shiro ä¸­ï¼Œé»˜è®¤çš„è®¿é—®è·¯å¾„å°±æ˜¯ login.jsp é¡µé¢ï¼Œè¯¥é¡¹å¯ä»¥é€šè¿‡ setLoginUrl æ–¹æ³•æ¥æ‰§è¡Œéœ€è¦è·³è½¬çš„è®¤è¯é¡µé¢ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// shiroæœ‰ä¸€ä¸ªé»˜è®¤çš„è®¤è¯ç•Œé¢è·¯å¾„ï¼Œé»˜è®¤å°±æ˜¯ login.jsp é¡µé¢</span>
factoryBean<span class="token punctuation">.</span><span class="token function">setLoginUrl</span><span class="token punctuation">(</span><span class="token string">"/your/login/path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>å¦‚æœä»¥è¿›è¡Œè®¤è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ­£å¸¸è¿›è¡Œè®¿é—®äº†ã€‚</p>
<h2 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h2><p>æ–°å»ºä¸€ä¸ª shiro æ•°æ®åº“ï¼Œåˆ›å»ºä¸€ä¸ª t_user è¡¨ï¼Œè¡¨ä¸­çš„å­—æ®µåˆ†åˆ«å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> t_user
<span class="token punctuation">(</span>
    id       <span class="token keyword">int</span> <span class="token keyword">auto_increment</span>      <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span>  <span class="token boolean">null</span><span class="token punctuation">,</span>
    password <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span>  <span class="token boolean">null</span><span class="token punctuation">,</span>
    salt     <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>ç„¶ååˆ©ç”¨ MybatisX-generator ç”Ÿæˆç›¸å¯¹åº”çš„ mapper ä»¥åŠå¯¹åº”çš„å®ä½“ç±»ï¼Œè¯¥æ’ä»¶å¯ä»¥åœ¨ idea ä¸­æ‰¾åˆ°å¹¶å®‰è£…ã€‚</p>
<h2 id="æ³¨å†ŒåŠŸèƒ½å®ç°"><a href="#æ³¨å†ŒåŠŸèƒ½å®ç°" class="headerlink" title="æ³¨å†ŒåŠŸèƒ½å®ç°"></a>æ³¨å†ŒåŠŸèƒ½å®ç°</h2><p>ç”¨æˆ·æ³¨å†Œçš„å®ç°ä¹Ÿæ˜¯éå¸¸ç®€å•çš„ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"register"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">TUser</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"redirect:/login.jsp"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"redirect:/register.jsp"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>å¯†ç çš„åŠ å¯†ä½¿ç”¨çš„æ˜¯ MD5 æ¥å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œåˆ©ç”¨åŠ ç›å·¥å…·ç±»ï¼Œä¼ å…¥æ˜æ–‡å¯†ç ï¼Œç›å€¼å’Œè¿­ä»£æ¬¡æ•°å³å¯ï¼Œç›¸å…³çš„ä»£ç åœ¨åé¢çš„é™„å½•ä¸­ã€‚</p>
<h2 id="ç™»å½•åŠŸèƒ½å®ç°"><a href="#ç™»å½•åŠŸèƒ½å®ç°" class="headerlink" title="ç™»å½•åŠŸèƒ½å®ç°"></a>ç™»å½•åŠŸèƒ½å®ç°</h2><p>ç™»å½•çš„å®ç°é€»è¾‘å¦‚ä¸‹ï¼Œé¦–å…ˆè·å– Subjectï¼Œç„¶åè°ƒç”¨ç™»å½•æ–¹æ³•ã€‚åˆ©ç”¨æ•è·çš„å“ªäº›å¼‚å¸¸æ¥è¯´æ˜ç™»å½•å¤±è´¥çš„åŸå› ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"redirect:/index.jsp"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·åé”™è¯¯!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯†ç é”™è¯¯!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token string">"redirect:/login.jsp"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>ç„¶ååœ¨è‡ªå®šä¹‰çš„ Realm ä¸­ï¼Œé‡å†™è®¤è¯çš„æ–¹æ³•ï¼Œè°ƒç”¨ userServiceï¼Œåˆ¤æ–­æ˜¯å¦æŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœæœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆæ¯”å¯¹ç”¨æˆ·çš„å¯†ç ã€‚åˆ›å»º SimpleAuthenticationInfo å¯¹è±¡æ¥å¯¹ç”¨æˆ·è¿›è¡Œè¿‡è®¤è¯ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> authenticationToken<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====================================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> authenticationToken<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æŒ‰ç…§ç”¨æˆ·åæŸ¥è¯¢</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> <span class="token class-name">ApplicationUtils</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TUser</span> userInfo <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">findUserInfo</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ç”¨æˆ·åã€å¯†ç ã€ç›å€¼ã€åå­—ã€‚</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ByteSource<span class="token punctuation">.</span>Util</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>åœ¨ SimpleAuthenticationInfo ç±»ä¸­ï¼Œå¦‚æœæ˜¯å¯¹åŠ å¯†çš„å¯†ç è¿›è¡Œæ¯”è¾ƒï¼Œéœ€è¦æœ‰ 4 ä¸ªå‚æ•°ï¼šä¸€ä¸ªç”¨æˆ·åã€ä¸€ä¸ªåŠ å¯†æ‰€ä½¿ç”¨çš„ç›å€¼ã€ä¸€ä¸ªåŠ å¯†çš„ç±»å‹å’Œ realm çš„åå­—ã€‚å¦‚æœæ˜¯æ¯”è¾ƒæ˜æ–‡çš„è¯ï¼Œåªéœ€è¦ä¸‰ä¸ªå‚æ•°å³å¯ï¼Œåˆ†åˆ«æ˜¯ç”¨æˆ·åã€å¯†ç ã€ realm çš„åå­—ã€‚</p>
<p>è¿™æ ·ï¼Œç™»å½•åŠŸèƒ½å°±åŸºæœ¬ä¸Šå®ç°äº†ã€‚åªè¦è®¤è¯æˆåŠŸä¹‹åå°±èƒ½è®¿é—®ä¸»é¡µäº†ã€‚</p>
<p><img src="/journal/shiro-spring/image-20220329114737704.png" alt="image-20220329114737704" loading="lazy"></p>
<h2 id="é€€å‡ºç™»å½•åŠŸèƒ½å®ç°"><a href="#é€€å‡ºç™»å½•åŠŸèƒ½å®ç°" class="headerlink" title="é€€å‡ºç™»å½•åŠŸèƒ½å®ç°"></a>é€€å‡ºç™»å½•åŠŸèƒ½å®ç°</h2><p>é€€å‡ºåŠŸèƒ½å¾ˆç®€å•ï¼Œåªéœ€è°ƒç”¨ logout æ–¹æ³•å³å¯ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"logout"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subject<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">"redirect:/login.jsp"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="æˆæƒåŠŸèƒ½å®ç°"><a href="#æˆæƒåŠŸèƒ½å®ç°" class="headerlink" title="æˆæƒåŠŸèƒ½å®ç°"></a>æˆæƒåŠŸèƒ½å®ç°</h2><blockquote>
<p>è¿™é‡Œåªåšä¸€ä¸ªç®€å•çš„æˆæƒåŠŸèƒ½å®ç°ï¼Œç”±äºè¿˜æ²¡æœ‰æˆæƒä¹‹ç±»çš„ç›¸å…³è¡¨ï¼Œåé¢å†è¯¦ç»†çš„ä»‹ç»æˆæƒçš„å®Œæ•´æµç¨‹ã€‚</p>
</blockquote>
<p>æ¯ä¸ªç”¨æˆ·ç™»å½•ä¹‹åï¼Œåº”è¯¥éœ€è¦æˆäºˆå¯¹åº”çš„è§’è‰²å’Œæƒé™ã€‚è‹¥è¦ç»™å¯¹åº”çš„ç”¨æˆ·èµ‹äºˆå¯¹åº”çš„æƒé™ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ª SimpleAuthorizationInfo å¯¹è±¡ï¼Œç”¨äºæˆäºˆè§’è‰²å’Œæƒé™ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘è¦ç»™ xiaohe123 è¿™ä¸ªç”¨æˆ·æˆäºˆç®¡ç†å‘˜è§’è‰²ã€‚è¯¥ç®¡ç†å‘˜çš„è§’è‰²æ‹¥æœ‰ç”¨æˆ·æ“ä½œï¼Œæ‰€æœ‰è®¢å•ä¿å­˜å’Œæ‰€æœ‰å•†å“ä¿å­˜ï¼Œå¯ä»¥è¿™æ ·å†™ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principalCollection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// è·å–èº«ä»½ä¿¡æ¯</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> principalCollection<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨æˆæƒéªŒè¯ï¼š"</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SimpleAuthorizationInfo</span> authorizationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"xiaohe123"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">addRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">"user:*:*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">"order:save:*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">"shop:save:*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authorizationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"xiaohe124"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">addRole</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">"user:revise:*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">"user:update:*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authorizationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>addRole æ–¹æ³•å°±æ˜¯æˆäºˆè§’è‰²ï¼ŒaddStringPermission å°±æ˜¯æ ¹æ®å­—ç¬¦ä¸²æ¥æˆäºˆç›¸å¯¹åº”çš„æƒé™ã€‚æˆæƒæ–¹å¼å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡çš„æ—¥å¿—ã€‚</p>
<h3 id="æƒé™åˆ¤æ–­æ–¹å¼"><a href="#æƒé™åˆ¤æ–­æ–¹å¼" class="headerlink" title="æƒé™åˆ¤æ–­æ–¹å¼"></a>æƒé™åˆ¤æ–­æ–¹å¼</h3><p>æˆæƒå®Œæˆä¹‹åï¼Œå°±å¯ä»¥åˆ¤æ–­ç”¨æˆ·å…·å¤‡é‚£äº›æƒé™äº†ã€‚åˆ¤æ–­æƒé™æœ‰å¤šç§æ–¹å¼ï¼Œå¯ä»¥åœ¨ jsp ä¸­å¼•å…¥ shiro æ ‡ç­¾ï¼Œå¯ä»¥é€šè¿‡ç¨‹åºè¿›è¡Œåˆ¤æ–­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥åˆ¤æ–­ã€‚</p>
<h4 id="Shiro-æ ‡ç­¾å¯¹åˆ¤æ–­æ–¹å¼"><a href="#Shiro-æ ‡ç­¾å¯¹åˆ¤æ–­æ–¹å¼" class="headerlink" title="Shiro æ ‡ç­¾å¯¹åˆ¤æ–­æ–¹å¼"></a>Shiro æ ‡ç­¾å¯¹åˆ¤æ–­æ–¹å¼</h4><p>åˆ©ç”¨ jstl æ ‡ç­¾åˆ¤æ–­æƒé™ï¼Œä¸åŒçš„è§’è‰²æ¥ç”¨äºå±•ç¤ºä¸åŒçš„èœå•é¡µã€‚</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasAnyRoles</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user,admin<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ç”¨æˆ·ç®¡ç†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasPermission</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user:add:*<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ·»åŠ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasPermission</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasPermission</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user:update:*<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä¿®æ”¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasPermission</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasPermission</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user:delete:*<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>åˆ é™¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasPermission</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasPermission</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user:update:*<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ›´æ–°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasPermission</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasAnyRoles</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasRole</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>admin<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- ç®¡ç†å‘˜æƒé™å¯è§ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å•†å“ç®¡ç†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ç‰©æµç®¡ç†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>è®¢å•ç®¡ç†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasRole</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre>

<p>æŒ‰ç…§æˆæƒçš„ä»£ç æ¥è®²ï¼Œå¦‚æœæˆ‘ç™»å½•çš„è´¦æˆ·æ˜¯ xiaohe123ï¼Œé‚£ä¹ˆå®ƒå…·å¤‡ç”¨æˆ·æ“ä½œçš„æ‰€æœ‰æƒé™ï¼Œå’Œå…¶å®ƒçš„åŠŸèƒ½ã€‚å¦‚æœæ˜¯ xiaohe124ï¼Œé‚£ä¹ˆå®ƒåªæœ‰ç”¨æˆ·çš„ä¿®æ”¹å’Œæ›´æ–°æ“ä½œã€‚</p>
<p>ä¸‹å›¾æ˜¯ xiaohe124 çš„é¡µé¢ã€‚</p>
<p><img src="/journal/shiro-spring/image-20220329143610917.png" alt="image-20220329143610917" loading="lazy"></p>
<p>ä¸‹å›¾æ˜¯ xiaohe123 çš„é¡µé¢ã€‚</p>
<p><img src="/journal/shiro-spring/image-20220329114737704.png" alt="image-20220329114737704" loading="lazy"></p>
<h4 id="ç¨‹åºåˆ¤æ–­çš„æ–¹å¼"><a href="#ç¨‹åºåˆ¤æ–­çš„æ–¹å¼" class="headerlink" title="ç¨‹åºåˆ¤æ–­çš„æ–¹å¼"></a>ç¨‹åºåˆ¤æ–­çš„æ–¹å¼</h4><p>ç¨‹åºçš„åˆ¤æ–­åœ¨ä¸Šä¸€ç¯‡çš„æ—¥å¿—ä¸­æœ‰æåŠåˆ°ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªå°ä¾‹å­ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"save"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// è·å–ä¸»é¢˜å¯¹è±¡</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä»£ç æ–¹å¼</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æŒ‰ç…§æƒé™å­—ç¬¦ä¸²</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">"order:save:*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¿å­˜è®¢å•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¿å­˜è®¢å•å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ— æƒè®¿é—®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token string">"redirect:/index.jsp"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="æ³¨è§£åˆ¤æ–­æ–¹å¼"><a href="#æ³¨è§£åˆ¤æ–­æ–¹å¼" class="headerlink" title="æ³¨è§£åˆ¤æ–­æ–¹å¼"></a>æ³¨è§£åˆ¤æ–­æ–¹å¼</h4><p>æ³¨è§£çš„åˆ¤æ–­åœ¨æ§åˆ¶å±‚ä¸Šï¼Œåˆ©ç”¨ @RequireRoles æ³¨è§£å°±ç±»ä¼¼äº <code>subject.hasRole</code> æ–¹æ³•æ¥åˆ¤æ–­æƒé™çš„è§„åˆ™ã€‚åˆ©ç”¨ @RequiresPermissions æ³¨è§£ç”¨äºåˆ¤æ–­è¯¥è§’è‰²å¯¹åº”çš„ç›¸å…³æƒé™ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä»£ç ï¼Œè®¿é—®çš„ç”¨æˆ·å¿…é¡»æ˜¯ admin çš„è§’è‰²ï¼Œä¸”èƒ½å¤Ÿä¿å­˜å•†å“ç¼–å·ä¸º 114 çš„å•†å“ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"saveShop"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequiresRoles</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span> <span class="token comment">// ç”¨æ¥åˆ¤æ–­è§’è‰²</span>
<span class="token annotation punctuation">@RequiresPermissions</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"shop:save:114"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveShop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å•†å“ä¿¡æ¯ä¿å­˜ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">"redirect:/index.jsp"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>å½“æˆ‘æ˜¯ xiaohe123 æ“ä½œæ—¶ï¼Œå®ƒçš„æƒé™å­—ç¬¦ä¸²æ˜¯ <code>shop:save:*</code> ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½å¤Ÿä¿å­˜å…¨éƒ¨çš„å•†å“ä¿¡æ¯ï¼Œè‡ªç„¶ä¹Ÿå°±åŒ…æ‹¬ 114 è¿™ä¸ªå•†å“äº†ã€‚</p>
<h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><p>UserService ä»£ç </p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TUserMapper</span> tUserMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">TUser</span> tUser<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> salt <span class="token operator">=</span> <span class="token class-name">SaltUtils</span><span class="token punctuation">.</span><span class="token function">getSalt</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”Ÿæˆ md5ï¼Œä¼ å…¥æ˜æ–‡å¯†ç ï¼Œç›å€¼å’Œè¿­ä»£æ¬¡æ•°ã€‚</span>
        <span class="token class-name">Md5Hash</span> md5Hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Md5Hash</span><span class="token punctuation">(</span>tUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tUser<span class="token punctuation">.</span><span class="token function">setSalt</span><span class="token punctuation">(</span>salt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tUser<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>md5Hash<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tUserMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>tUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">TUser</span> <span class="token function">findUserInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TUser</span> user <span class="token operator">=</span> tUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TUser</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>ApplicationUtils.java</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * è·å– spring å®¹å™¨ä¸­çš„ bean å¯¹è±¡
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationUtils</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ApplicationContext</span> context<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>
        context <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>SaltUtils.java</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaltUtils</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getSalt</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()"</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">char</span> c <span class="token operator">=</span> chars<span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>chars<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
<span class="token punctuation">&#125;</span></code></pre>

</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>BestGuo2020</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://www.bestguo.top/journal/shiro-spring/" title="Shiro ä¸ SpringBoot æ•´åˆ">https://www.bestguo.top/journal/shiro-spring/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/journal/shiro-permission-data-persistence/" rel="prev" title="Shiro æƒé™æ•°æ®æŒä¹…åŒ–"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">Shiro æƒé™æ•°æ®æŒä¹…åŒ–</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/journal/shiro-study/" rel="next" title="Shiro å­¦ä¹ å°è®°"><span class="post-nav-text">Shiro å­¦ä¹ å°è®°</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>è¯·è¯¸ä½ç†æ€§å‘è¨€ï¼</span><br><span>è¯·å‹¿å‘å¸ƒè¿åä¸­å›½å¤§é™†åœ°åŒºæ³•å¾‹çš„è¨€è®ºï¼Œè¯·å‹¿äººèº«æ”»å‡»ã€è°©éª‚ã€ä¾®è¾±å’Œç…½åŠ¨å¼çš„è¯­è¨€ã€‚</span><br></div><div id="waline"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"><script>window.CONFIG.waline.config.path = "/journal/shiro-spring/"</script><div class="js-Pjax"><script src="/js/comments/waline.js" type="module" defer></script></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">èµ£ ICP å¤‡ 20009988 å·</a></div><div class="copyright"><span>&copy; 2019 â€“ 2022 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> BestGuo2020</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v6.2.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.0</span></div><div class="live-time"><span>æœ¬ç«™ç‚¹å·²æ­£å¸¸åœ°è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text"><br/>â™¬(ãƒã‚œâˆ‡ã‚œ)ãƒâ™©<br></span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2019-01-01T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} å¤© ${passHour} å°æ—¶ ${passMinute} åˆ† ${passSecond} ç§’`;
}
blog_live_time();
</script></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="æ€»è®¿å®¢é‡"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="æ€»è®¿é—®é‡"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="footer-support"><span>æœ¬ç½‘ç«™ç”±</span><a class="footer-support-logo" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" target="blank" title="åˆæ‹äº‘"><img height="30" src="https://cdn.yunyoujun.cn/img/logo/upyun-logo.png" alt="åˆæ‹äº‘"></a><span>æä¾› CDN åŠ é€ŸæœåŠ¡</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="æœç´¢"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="æœç´¢..." value=""></div><div id="local-search-result"></div></div></div></body></html>